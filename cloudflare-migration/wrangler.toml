# Cloudflare Workers configuration for Tienda POS
name = "tienda-pos-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Account details
account_id = "b85347650ec6de9ad5b2873c3389d0e6"

# Environment variables
[env.production]
vars = { ENVIRONMENT = "production" }

[env.development]
vars = { ENVIRONMENT = "development" }

# KV namespace para metadata de tenants (mapeo de clerk_user_id -> db_name)
[[kv_namespaces]]
binding = "TENANTS"
id = "2003e0a6ed1e4f7cb1033c7e9249d7dd"
preview_id = "0ff63456aa9f45049dbefc3cf4f0cc01"

# D1 database para gestión de tenants
[[d1_databases]]
binding = "TENANTS_DB"
database_name = "tenants-manager"
database_id = "e6998ff4-2167-43a1-b0e4-1420849a08d7"

# D1 database compartida (Opción B - con tenant_id)
[[d1_databases]]
binding = "DB"
database_name = "tienda-pos-shared"
database_id = "9d71dfad-5c36-4dac-9c4a-b0716ebe3d20"

# CORS configuration
# [site]
# bucket = ""

# Rutas de la API (comentadas por ahora, se configuran después del deploy)
# [[routes]]
# pattern = "api.tudominio.com/*"
# zone_name = "tudominio.com"

# Cron Triggers para automatización de emails
# Docs: https://developers.cloudflare.com/workers/configuration/cron-triggers/
[triggers]
crons = [
  "0 9 * * *",    # Recordatorios de suscripción - 9 AM diario
  "0 */1 * * *",  # Reportes diarios - cada hora (verifica preferencias)
  "0 */2 * * *",  # Alertas de stock - cada 2 horas
  "0 * * * *"     # Carritos abandonados - cada hora
]
